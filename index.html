
<html lang="en">

  <head>
    <meta charset="utf-8">

    <base target="_blank" />
    <title>Overview of Web Audio API</title>

    <meta name="description" content="An Overview of Web Audio API">
    <meta name="author" content="Gaëtan Renaudeau">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="css/reveal.min.css">
    <link rel="stylesheet" href="css/theme/moon.css" id="theme">

    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- If the query includes 'print-pdf', use the PDF print sheet -->
    <script>
      document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->

    <style type="text/css">
      .reveal h2 {
        text-transform: initial;
      }
      h1, h2, h3, h4 {
        clear: both;
      }
      a.toggle-source {
        font-size: 0.5em;
      }
      input[type=range] {
        -webkit-appearance: none;
        -webkit-box-shadow: inset 0px 4px 10px rgba(0,0,0,0.5), 0px 2px 1px rgba(255,255,255,0.2);
        margin: 8px 0;
        border-radius: 6px;
        height: 20px;
        opacity: 0.9;
      }
      input[type="range"]:hover {
        opacity: 1;
      }

      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        -webkit-box-shadow: inset 0px 2px 6px #FFF;
        background-image: -webkit-gradient(linear, left top, right top, color-stop(0.48, #DDD), color-stop(0.5, #AAA), color-stop(0.52, #DDD));
        border: 1px solid #AAA;
        border-radius: 3px;
        width: 40px;
        height: 26px;
      }
      
      input[type="range"]:hover::-webkit-slider-thumb {
      }
    </style>
    <script type="text/javascript" src="bower_components/q/q.js"></script>
    <script type="text/javascript" src="bower_components/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="bower_components/underscore/underscore-min.js"></script>
    <script type="text/javascript" src="bower_components/backbone/backbone-min.js"></script>
    <script type="text/javascript" src="audioutils.js"></script>
    <script type="text/javascript" src="audioparams.js"></script>
    <script type="text/javascript" src="audioviz.js"></script>
    <script type="text/javascript">
      (function(){
        function updateInputRange (e) {
          var target = $(e.target||e);
          var val = (target.val() - target.attr('min')) / (target.attr('max') - target.attr('min'));
          target.css('background-image',
            '-webkit-gradient(linear, left top, right top, '
              + 'color-stop(' + val + ', #99DDFF), '
              + 'color-stop(' + val + ', #111111)'
              + ')'
              );
        }
        var render = ParameterSlider.prototype.render;
        ParameterSlider.prototype.render = function () {
          var res = render.apply(this, arguments);
          var el = this.$el.find("input[type=range]");
          el.on("change", updateInputRange);
          updateInputRange(el);
          setTimeout(function(){updateInputRange(el);},0);
          return res;
        };
      }());
    </script>
  </head>

  <body>
    <script type="text/javascript">
    window.onerror = function (e) {
      if (!console || !console.error) alert(e);
    }
    navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;
    var ctx = new (window.AudioContext || window.webkitAudioContext)();
    var music1 = loadSound(ctx, "audio/natura_morta.mp3");
    var music2 = loadSound(ctx, "audio/you_want_make_me_down.mp3");
    var userAudio = (function (d) {
      navigator.getUserMedia({ audio: true }, d.resolve, d.reject);
      return d.promise;
    }(Q.defer()));

    var microphone = userAudio.then(function (stream) {
      var mic = ctx.createMediaStreamSource(stream);
      var gain = ctx.createGain();
      gain.gain.value = 10;
      var compr = ctx.createDynamicsCompressor();
      mic.connect(gain);
      gain.connect(compr);
      return compr;
    });

    var queryStringParams = (function (queryString) {
      return _.reduce(queryString.substring(1).split("&"), function (obj, param) {
        var parts = param.split("=");
        obj[parts[0]] = parts[1];
        return obj;
      }, {});
    }(location.search));
    window.KEYBOARD_LAYOUT = queryStringParams.azerty ? "AZERTY" : "QWERTY";

    var keyboardController = new KeyboardController(KeyboardController[window.KEYBOARD_LAYOUT+"config"]);
    var midiController = new MIDIController();

    var keyboard = new Backbone.Model();
    midiController.on("noteOn", _.bind(keyboard.trigger, keyboard, "noteOn"));
    midiController.on("noteOff", _.bind(keyboard.trigger, keyboard, "noteOff"));
    keyboardController.on("noteOn", _.bind(keyboard.trigger, keyboard, "noteOn"));
    keyboardController.on("noteOff", _.bind(keyboard.trigger, keyboard, "noteOff"));
    </script>

    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">
        <section data-markdown>
          # Web Audio API

          ## Overview

          by Gaëtan Renaudeau - <a href="http://twitter.com/greweb">@greweb</a>
        </section>

        <section data-markdown>
          # Summary

          * Audio basics
          * DSP
          * Visualizing sound
          * The Web Audio API
          * AudioNodes...
        </section>

        <section>
        <section data-markdown>
          # Audio Basics
        </section>

        <section data-markdown>
          ### Compression wave
          
          * Air density variation
          * Longitudinal, like a spring
          * Propagation: ~ 343 m/s in dry air, 20°C

          ![](./images/compressions.gif)
        </section>

        <section data-markdown>
          ### Amplitude

          * Decibel: Difference of sound pressure

          ![](./images/amplitude.png)
        </section>

        <section data-markdown>
          ### Frequency

          * Vibration speed (in Hertz = pulse per second)
          * human hearing range: 20 Hz to 20'000 Hz

          ![](./images/frequency.png)
        </section>
        </section>

        <section>
        <section data-markdown>
          # Digital Signal Processing
        </section>
        <section data-markdown>
          ## Sampling

          * 44100 samples per second
        </section>
        <section data-markdown>
          ## Quantization

          ![](./images/quantization.png)
        </section>
        </section>

        <section>
        <section data-markdown>
          # Visualizing sound
        </section>

        <section>
          <h2>Waveform</h2>
        <script type="text/javascript">hookRevealJS(function (div, end) {
          var out = ctx.createGain();
          var waveform = new Waveform({
            width: 960,
            height: 512
          });
          var waveformView = new WaveformView({
            model: waveform
          });
          waveformView.$el.appendTo(div);
          waveform.setNode(out, ctx);

          microphone.then(function (m) {
            m.connect(out);
          });

          (function loop () {
            if (end.isFulfilled()) return;
            requestAnimationFrame(loop);
            waveform.update();
          }());
          end.then(function () {
            $(div).empty();
          }).done();
        });</script>
        </section>

        <section>
          <h2>Spectrum Analyzer</h2>
        <script type="text/javascript">hookRevealJS(function (div, end) {
          var out = ctx.createGain();
          var spectrum = new Spectrum({
            width: 960,
            height: 512
          });
          var spectrumView = new SpectrumView({
            model: spectrum
          });
          spectrumView.$el.appendTo(div);
          spectrum.setNode(out, ctx);

          microphone.then(function (m) {
            m.connect(out);
          });

          (function loop () {
            if (end.isFulfilled()) return;
            requestAnimationFrame(loop);
            spectrum.update();
          }());
          end.then(function () {
            $(div).empty();
          }).done();
        });</script>
        </section>

        <section>
          <h2>Spectrogram</h2>

        <script type="text/javascript">hookRevealJS(function (div, end) {
          var out = ctx.createGain();
          var spectrogram = new Spectrogram({
            width: 960,
            height: 512
          });
          var spectrogramView = new SpectrogramView({
            model: spectrogram
          });
          spectrogramView.$el.appendTo(div);
          spectrogram.setNode(out, ctx);

          microphone.then(function (m) {
            m.connect(out);
          });

          (function loop () {
            if (end.isFulfilled()) return;
            requestAnimationFrame(loop);
            spectrogram.update();
          }());
          end.then(function () {
            $(div).empty();
          }).done();
        });</script>
        </section>
        </section>

        <section>
        <section data-markdown>
        # Web Audio API
        </section>

        <section data-markdown>
          ## Abstract

          > a high-level JavaScript API for processing and synthesizing audio in web applications. The primary paradigm is of an **audio routing graph**, where a number of **AudioNode** objects are connected together to define the overall audio rendering. The actual processing will primarily take place in the **underlying implementation** (typically optimized Assembly / C / C++ code), but **direct JavaScript** processing and synthesis is also supported.

          [spec](https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html)
        </section>

        <section data-markdown>
        ## Basic Modular Routing

        ![](./images/modular-routing1.png)
        </section>

        <section data-markdown>
        ## Modular Routing

        ![](./images/modular-routing2.png)
        </section>

          <section data-markdown>
          ## AudioContext

```
interface AudioContext : EventTarget {
    readonly attribute AudioDestinationNode destination;
    readonly attribute float sampleRate;
    readonly attribute double currentTime;
    readonly attribute AudioListener listener;

    AudioBufferSourceNode createBufferSource();
    MediaElementAudioSourceNode createMediaElementSource(HTMLMediaElement mediaElement);
    MediaStreamAudioSourceNode createMediaStreamSource(MediaStream mediaStream);
    MediaStreamAudioDestinationNode createMediaStreamDestination();
    ScriptProcessorNode createScriptProcessor(optional unsigned long bufferSize = 0, optional unsigned long numberOfInputChannels = 2, optional unsigned long numberOfOutputChannels = 2);
    AnalyserNode createAnalyser();
    GainNode createGain();
    DelayNode createDelay(optional double maxDelayTime = 1.0);
    BiquadFilterNode createBiquadFilter();
    WaveShaperNode createWaveShaper();
    PannerNode createPanner();
    ConvolverNode createConvolver();
    ChannelSplitterNode createChannelSplitter(optional unsigned long numberOfOutputs = 6);
    ChannelMergerNode createChannelMerger(optional unsigned long numberOfInputs = 6);
    DynamicsCompressorNode createDynamicsCompressor();
    OscillatorNode createOscillator();

    PeriodicWave createPeriodicWave(Float32Array real, Float32Array imag);
    AudioBuffer createBuffer(unsigned long numberOfChannels, unsigned long length, float sampleRate);
    void decodeAudioData(ArrayBuffer audioData, DecodeSuccessCallback successCallback, optional DecodeErrorCallback errorCallback);

};
```
          </section>

        <section data-markdown>
          ## TL;DR.

          * AudioContext allows to create different **AudioNode**.
          * \+ constants: *sampleRate*, *currentTime*, *destination*
        </section>

        <section data-markdown>
          ## different AudioNodes

          * GainNode
          * OscillatorNode
          * BiquadFilterNode
          * DynamicsCompressorNode
          * DelayNode
          * ConvolverNode
          * WaveShaperNode
          * PannerNode, ChannelSplitterNode, ChannelMergerNode
          * AnalyserNode
          * AudioBufferSourceNode
          * MediaElementAudioSourceNode, MediaStreamAudioSourceNode, MediaStreamAudioDestinationNode
          * ScriptProcessorNode
        </section>

<section data-markdown>
## AudioNode

```
interface AudioNode : EventTarget {

    void connect(AudioNode destination, optional unsigned long output = 0, optional unsigned long input = 0);
    void connect(AudioParam destination, optional unsigned long output = 0);
    void disconnect(optional unsigned long output = 0);

    readonly attribute AudioContext context;
    readonly attribute unsigned long numberOfInputs;
    readonly attribute unsigned long numberOfOutputs;

    // Channel up-mixing and down-mixing rules for all inputs.
    attribute unsigned long channelCount;
    attribute ChannelCountMode channelCountMode;
    attribute ChannelInterpretation channelInterpretation;

};
```
</section>

        <section data-markdown>
          ## TL;DR.

          * an AudioNode is an abstract interface.
          * an AudioNode can be connected to an **AudioNode**.
          * an AudioNode can be connected to an **AudioParam**.
          * an AudioNode generally have different **AudioParam**s.
        </section>

        <section data-markdown>
          ## AudioParam

```
interface AudioParam {
    attribute float value;
    readonly attribute float defaultValue;

    void setValueAtTime(float value, double startTime);
    void linearRampToValueAtTime(float value, double endTime);
    void exponentialRampToValueAtTime(float value, double endTime);

    void setTargetAtTime(float target, double startTime, double timeConstant);

    void setValueCurveAtTime(Float32Array values, double startTime, double duration);

    void cancelScheduledValues(double startTime);
};
    ```
  </section>

        <section data-markdown>
          ## TL;DR.

          * an AudioParam represents a **value**.
          * You can set/get it with the **value** field.
          * You can **schedule** the value (setValueAtTime).
          * You can **automate** the value. (linearRamp, exponentialRamp)
        </section>

        <section data-markdown>
        ## Examples of value automation

        ![](./images/audioparam-automation1.png)
        </section>

        </section>

        <section>
          <section data-markdown>
            ## GainNode

            The simplest and most used AudioNode.

            It amplifies/reduces the amplitude of the audio stream.

```
interface GainNode : AudioNode {

    readonly attribute AudioParam gain;

};
```
          </section>
        </section>

        <section>
        <section data-markdown>
          ## OscillatorNode

          Fundamental periodic waveform.

```
enum OscillatorType {
  "sine",
  "square",
  "sawtooth",
  "triangle",
  "custom"
};

interface OscillatorNode : AudioNode {
    attribute OscillatorType type;
    readonly attribute AudioParam frequency; // in Hertz
    readonly attribute AudioParam detune; // in Cents

    void start(double when);
    void stop(double when);
    void setPeriodicWave(PeriodicWave periodicWave);
    attribute EventHandler onended;
};
```
        </section>

        <section>
          <h2>Oscillator</h2>

          <pre><code data-trim class="javascript">
var osc = ctx.createOscillator();
osc.type = "sine"; // "triangle" or "sawtooth" or "square"
osc.frequency = 440;
osc.start(0);
osc.connect(ctx.destination);
          </code></pre>

        <script type="text/javascript">hookRevealJS(function (div, end) {
          var out = ctx.createGain();
          var osc = ctx.createOscillator();

          var vizs = createVizs(ctx, div, out);

          var types = ["sine", "triangle", "sawtooth", "square"];

          var oscTypeParam = new Parameter({
            values: types,
            title: "Type",
            value: 0
          });
          var oscTypeSlider = new ParameterSlider({
            model: oscTypeParam
          });
          oscTypeSlider.$el.appendTo(div);
          oscTypeParam.on("change:value", function (m, value) {
            osc.type = types[value];
          });

          var freqParam = new Parameter({
            from: 0,
            to: 22000,
            value: 440,
            title: "Frequency"
          });
          var freqSlider = new ParameterSlider({
            model: freqParam
          });
          freqSlider.$el.appendTo(div);

          freqParam.on("change:value", function (m, value) {
            osc.frequency.linearRampToValueAtTime(value, ctx.currentTime+0.1);
          });

          osc.connect(out);
          out.connect(ctx.destination);
          osc.start(ctx.currentTime);

          (function loop () {
            if (end.isFulfilled()) return;
            requestAnimationFrame(loop);
            vizs.update();
          }());
          end.then(function () {
            out.disconnect(ctx.destination);
            osc.stop(ctx.currentTime);
            $(div).empty();
          }).done();
        });</script>
        </section>

        <section>
          <h2>Oscillator Frequency Modulation</h2>

          <img src="./images/fm_principle.png" style="width: 100%; background: #fff; padding: 10px" />

          <pre><code data-trim class="javascript">
var carrier = ctx.createOscillator(); carrier.start(0);
var modulator = ctx.createOscillator(); modulator.start(0);
var modGain = ctx.createGain(); modGain.gain.value = 440;
modulator.connect(modGain);
modGain.connect(carrier.frequency);
carrier.connect(ctx.destination);
          </code></pre>
        </section>

        <section>
          <h2>Oscillator Frequency Modulation</h2>

        <script type="text/javascript">hookRevealJS(function (div, end) {
          var out = ctx.createGain();

          var carrier = ctx.createOscillator(); carrier.start(0);
          var modulator = ctx.createOscillator(); modulator.start(0);
          var modGain = ctx.createGain(); modGain.gain.value = 440;
          modulator.connect(modGain);
          modGain.connect(carrier.frequency);
          carrier.connect(out);

          var vizs = createVizs(ctx, div, out);

          var freqParam = new Parameter({
            curve: "quad",
            from: 0,
            to: 4000,
            title: "Carrier Frequency"
          });
          var freqSlider = new ParameterSlider({
            model: freqParam
          });
          freqSlider.$el.appendTo(div);
          freqParam.on("change:value", function (m, value) {
            carrier.frequency.value = value;
            syncModGain();
          });

          var gainParam = new Parameter({
            from: 0,
            to: 1,
            value: 1,
            title: "Carrier Gain"
          });
          var gain = new ParameterSlider({
            model: gainParam
          });
          gain.$el.appendTo(div);
          gainParam.on("change:value", function (m, value) {
            out.gain.value = value;
          });

          var modfreqParam = new Parameter({
            curve: "quad",
            from: 0,
            to: 4000,
            title: "Modulator Frequency"
          });
          var modfreqSlider = new ParameterSlider({
            model: modfreqParam
          });
          modfreqSlider.$el.appendTo(div);
          modfreqParam.on("change:value", function (m, value) {
            modulator.frequency.value = value;
          });

          var modgainParam = new Parameter({
            from: 0,
            to: 1,
            value: 1,
            title: "Modulator Gain (%)"
          });
          var modgainV = new ParameterSlider({
            model: modgainParam
          });
          modgainV.$el.appendTo(div);
          modgainParam.on("change:value", function (m, value) {
            syncModGain();
          });

          function syncModGain () {
            modGain.gain.value = freqParam.get("value") * modgainParam.get("value");
          }

          freqParam.set("value", 110);
          modfreqParam.set("value", 1);

          out.connect(ctx.destination);
          (function loop () {
            if (end.isFulfilled()) return;
            requestAnimationFrame(loop);
            vizs.update();
          }());
          end.then(function () {
            out.disconnect(ctx.destination);
            carrier.stop(0);
            modulator.stop(0);
            $(div).empty();
          }).done();
        });</script>
        </section>
        </section>

        <section>
          <section data-markdown>
          ## ADSR Envelope

          ![](./images/ADSR_parameter.png)
          </section>
          <section data-markdown>
          ### Envelope is just automation on a Gain

          ```javascript
function noteEnvelope (gainNode, time, volume, a, d, s, r) {
  var ctx = gainNode.context;
  var gain = gainNode.gain;
  gain.value = 0;
  gain.cancelScheduledValues(0);
  gain.setValueAtTime(0, time);
  gain.linearRampToValueAtTime(volume, time + a);
  gain.linearRampToValueAtTime(volume * s, time + a + d);
  return function (t) {
    gain.cancelScheduledValues(0);
    gain.setValueAtTime(gain.value, t);
    gain.linearRampToValueAtTime(0, t + r);
    return Q.delay(1000*(0.1 + (t+r) - ctx.currentTime));
  };
}
          ```
          </section>
        <section>
          <h2>Envelope + Oscillator</h2>
        <script type="text/javascript">hookRevealJS(function (div, end) {
          var sample = ctx.createBufferSource();
          sample.loop = true;
          var out = ctx.createDynamicsCompressor();

          var vizs = createVizs(ctx, div, out);

          // TODO ADSR viz (editor?)

          var attackParam = new Parameter({
            from: 0, 
            to: 4,
            value: 0.1,
            title: "Attack"
          });
          var decayParam = new Parameter({
            from: 0, 
            to: 4,
            value: 0.2,
            title: "Decay"
          });
          var sustainParam = new Parameter({
            from: 0, 
            to: 1,
            value: 0.7,
            title: "Sustain"
          });
          var releaseParam = new Parameter({
            from: 0, 
            to: 4,
            value: 0.3,
            title: "Release"
          });

          _.each([attackParam, decayParam, sustainParam, releaseParam], function (param) {
            var slider = new ParameterSlider({
              model: param,
              width: "220px"
            });
            slider.$el.appendTo(div);
            slider.$el.css({
              "margin-left": "20px"
            });
          });

          var types = ["sine", "triangle", "sawtooth", "square"];
          var oscType = "sine";

          var oscTypeParam = new Parameter({
            values: types,
            title: "Oscillator Type",
            value: 0
          });
          var oscTypeSlider = new ParameterSlider({
            model: oscTypeParam,
            width: '50%'
          });
          oscTypeSlider.$el.appendTo(div);
          oscTypeParam.on("change:value", function (m, value) {
            oscType = types[value];
          });

          var notes = {};

          function noteOn (note) {
            if (note in notes) throw "Already playing";
            var freq = NOTES[note];
            if (!freq) throw "no such freq for note="+note;
            var osc = ctx.createOscillator();
            osc.type = oscType;
            osc.frequency.value = freq;
            osc.start(0);
            var gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(out);
            var envelopeOff = noteEnvelope(gain, ctx.currentTime, 1, attackParam.get("value"), decayParam.get("value"), sustainParam.get("value"), releaseParam.get("value"));
            notes[note] = { osc: osc, gain: gain, envelopeOff: envelopeOff };
          }
          function noteOff (note) {
            if (!(note in notes)) throw "no such notes";
            var data = notes[note];
            delete notes[note];
            data.envelopeOff(ctx.currentTime).then(function () {
              data.osc.stop(0);
              data.gain.disconnect(out);
            });
          }

          keyboard.on("noteOn", noteOn);
          keyboard.on("noteOff", noteOff);

          out.connect(ctx.destination);
          (function loop () {
            if (end.isFulfilled()) return;
            requestAnimationFrame(loop);
            vizs.update();
          }());
          end.then(function () {
            keyboard.off("noteOn", noteOn);
            keyboard.off("noteOff", noteOff);
            _.each(notes, function (data, note) {
              noteOff(note);
            });
            out.disconnect(ctx.destination);
            $(div).empty();
          }).done();
          });</script>

        <hr />

        <p style="font-size: 0.6em; font-style: italic">
          QWERTY keyboard is used by default. 
          try 'ZXCVBNM' and 'QWERTYU' keys. Black keys are also supported and you can change octaves with "." and "/" keys.
          use ?azerty=1 in the URL if you prefer AZERTY.
          MIDI keyboard is also supported! (today needs Chrome Canary with flags)
        </p>

        </section>
        <section>
          <h2>FM Oscillator + 2 envelopes</h2>
        <script type="text/javascript">hookRevealJS(function (div, end) {
          var sample = ctx.createBufferSource();
          sample.loop = true;
          var out = ctx.createDynamicsCompressor();

          var vizs = createVizs(ctx, div, out);

          // TODO ADSR viz (editor?)

          var attackParam = new Parameter({
            from: 0, 
            to: 4,
            value: 0.1,
            title: "Attack"
          });
          var decayParam = new Parameter({
            from: 0, 
            to: 4,
            value: 0.2,
            title: "Decay"
          });
          var sustainParam = new Parameter({
            from: 0, 
            to: 1,
            value: 0.7,
            title: "Sustain"
          });
          var releaseParam = new Parameter({
            from: 0, 
            to: 4,
            value: 0.5,
            title: "Release"
          });

          _.each([attackParam, decayParam, sustainParam, releaseParam], function (param) {
            var slider = new ParameterSlider({
              model: param,
              width: "220px"
            });
            slider.$el.appendTo(div);
            slider.$el.css({
              "margin-left": "20px"
            });
          });

          var modattackParam = new Parameter({
            from: 0, 
            to: 4,
            value: 0.3,
            title: "Attack"
          });
          var moddecayParam = new Parameter({
            from: 0, 
            to: 4,
            value: 0.5,
            title: "Decay"
          });
          var modsustainParam = new Parameter({
            from: 0, 
            to: 1,
            value: 0.4,
            title: "Sustain"
          });
          var modreleaseParam = new Parameter({
            from: 0, 
            to: 4,
            value: 0.3,
            title: "Release"
          });

          _.each([modattackParam, moddecayParam, modsustainParam, modreleaseParam], function (param) {
            var slider = new ParameterSlider({
              model: param,
              width: "220px"
            });
            slider.$el.appendTo(div);
            slider.$el.css({
              "margin-left": "20px"
            });
          });

          var modGainValue;
          var ratio;
          var modulationRatios = [
            [1, 0.2],
            [1, 0.25],
            [1, 0.5],
            [1, 1],
            [1, 2],
            [1, 3],
            [1, 4],
            [2, 1],
            [2, 3],
            [3, 2],
            [3, 1],
            [4, 1],
            [4, 2],
            [4, 3]
          ];

          var ratioParam = new Parameter({
            values: modulationRatios,
            title: "Ratios (carrier, modulator)"
          });
          var ratioView = new ParameterSlider({
            model: ratioParam
          });
          ratioView.$el.appendTo(div);
          ratioParam.on("change:value", function (m, i) {
            ratio = modulationRatios[i];
          });

          var modGainParam = new Parameter({
            from: 0,
            to: 1,
            title: "Mod Gain (%)"
          });
          var modGainView = new ParameterSlider({
            model: modGainParam
          });
          modGainView.$el.appendTo(div);
          modGainParam.on("change:value", function (m, value) {
            modGainValue = value;
          });

          modGainParam.set("value", 1);
          ratioParam.set("value", 1);

          var notes = {};

          function noteOn (note) {
            if (note in notes) throw "Already playing";
            var freq = NOTES[note];
            if (!freq) throw "no such freq for note="+note;
            var osc = ctx.createOscillator();
            osc.type = "sine";
            osc.frequency.value = freq*ratio[0];
            osc.start(0);
            var gain = ctx.createGain();

            var mod = ctx.createOscillator(); mod.start(0);
            mod.frequency.value = freq*ratio[1];
            var modGain = ctx.createGain();
            mod.connect(modGain);
            modGain.connect(osc.frequency);

            osc.connect(gain);
            gain.connect(out);
            var envelopeOff = noteEnvelope(gain, ctx.currentTime, 1, attackParam.get("value"), decayParam.get("value"), sustainParam.get("value"), releaseParam.get("value"));
            var envelopeOffMod = noteEnvelope(modGain, ctx.currentTime, modGainValue*ratio[0]*freq, modattackParam.get("value"), moddecayParam.get("value"), modsustainParam.get("value"), modreleaseParam.get("value"));
            notes[note] = { 
              osc: osc, 
              mod: mod,
              gain: gain, 
              envelopeOff: envelopeOff,
              envelopeOffMod: envelopeOffMod
            };
          }
          function noteOff (note) {
            if (!(note in notes)) throw "no such notes";
            var data = notes[note];
            delete notes[note];
            Q.all([
              data.envelopeOffMod(ctx.currentTime),
              data.envelopeOff(ctx.currentTime)
            ]).then(function () {
              data.osc.stop(0);
              data.mod.stop(0);
              data.gain.disconnect(out);
            });
          }

          keyboard.on("noteOn", noteOn);
          keyboard.on("noteOff", noteOff);

          out.connect(ctx.destination);
          (function loop () {
            if (end.isFulfilled()) return;
            requestAnimationFrame(loop);
            vizs.update();
          }());
          end.then(function () {
            keyboard.off("noteOn", noteOn);
            keyboard.off("noteOff", noteOff);
            _.each(notes, function (data, note) {
              noteOff(note);
            });
            out.disconnect(ctx.destination);
            $(div).empty();
          }).done();
          });</script>
        
        </section>
        </section>

        <section>
          <section data-markdown>
            ## AudioBufferSourceNode

            Play a sample.

```
interface AudioBufferSourceNode : AudioNode {

    attribute AudioBuffer? buffer;

    readonly attribute AudioParam playbackRate;

    attribute boolean loop;
    attribute double loopStart;
    attribute double loopEnd;

    void start(optional double when = 0, optional double offset = 0, optional double duration);
    void stop(optional double when = 0);

    attribute EventHandler onended;

};
```
          </section>
        <section>
          <h2>AudioBufferSourceNode</h2>
        <script type="text/javascript">hookRevealJS(function (div, end) {
          var sample = ctx.createBufferSource();
          sample.loop = true;
          var out = ctx.createGain();

          var vizs = createVizs(ctx, div, out);

          var playbackRateParam = new Parameter({
            curve: "quad",
            from: 0.01,
            to: 10,
            value: 1,
            title: "playbackRate"
          });
          var playback = new ParameterSlider({
            model: playbackRateParam
          });
          playback.$el.appendTo(div);

          playbackRateParam.on("change:value", function (m, value) {
            sample.playbackRate.linearRampToValueAtTime(value, ctx.currentTime+0.2);
          });

          music2.then(function (buffer) {
            sample.buffer = buffer;
            sample.start(ctx.currentTime);
            sample.connect(out);
          });

          out.connect(ctx.destination);
          (function loop () {
            if (end.isFulfilled()) return;
            requestAnimationFrame(loop);
            vizs.update();
          }());
          end.then(function () {
            out.disconnect(ctx.destination);
            sample.stop(ctx.currentTime);
            $(div).empty();
          }).done();
        });</script>
        </section>
        </section>

        <section>
        <section data-markdown>
          ## BiquadFilterNode
```
enum BiquadFilterType {
  "lowpass",
  "highpass",
  "bandpass",
  "lowshelf",
  "highshelf",
  "peaking",
  "notch",
  "allpass"
};

interface BiquadFilterNode : AudioNode {

    attribute BiquadFilterType type;
    readonly attribute AudioParam frequency; // in Hertz
    readonly attribute AudioParam detune; // in Cents
    readonly attribute AudioParam Q; // Quality factor
    readonly attribute AudioParam gain; // in Decibels

    void getFrequencyResponse(Float32Array frequencyHz,
                              Float32Array magResponse,
                              Float32Array phaseResponse);

};
```
          </section>

        <section>
          <h2>Filter</h2>
        <script type="text/javascript">hookRevealJS(function (div, end) {
          var sample = ctx.createBufferSource();
          sample.loop = true;
          var out = ctx.createDynamicsCompressor();
          var types = [
          "lowpass",
          "highpass",
          "bandpass",
          "lowshelf",
          "highshelf",
          "peaking",
          "notch",
          "allpass"
          ];

          var filter = ctx.createBiquadFilter();

          var vizs = createVizs(ctx, div, out);

          var typeParam = new Parameter({
            values: types,
            title: "Type"
          });
          var typeV = new ParameterSlider({
            model: typeParam
          });
          typeV.$el.appendTo(div);
          typeParam.on("change:value", function (m, value) {
            filter.type = types[value];
          });

          var frequencyParam = new Parameter({
            curve: "quad",
            from: 0,
            to: 15000,
            value: 400,
            title: "Frequency"
          });
          var frequency = new ParameterSlider({
            model: frequencyParam
          });
          frequency.$el.appendTo(div);
          frequencyParam.on("change:value", function (m, value) {
            filter.frequency.value = value;
          });

          var qParam = new Parameter({
            from: 0,
            to: 50,
            value: 0,
            title: "Q"
          });
          var q = new ParameterSlider({
            model: qParam
          });
          q.$el.appendTo(div);
          qParam.on("change:value", function (m, value) {
            filter.Q.value = value;
          });

          var gainParam = new Parameter({
            from: 0,
            to: 50,
            value: 0,
            title: "Gain"
          });
          var gain = new ParameterSlider({
            model: gainParam
          });
          gain.$el.appendTo(div);
          gainParam.on("change:value", function (m, value) {
            filter.gain.value = value;
          });

          music2.then(function (buffer) {
            sample.buffer = buffer;
            sample.start(ctx.currentTime);
            sample.connect(filter);
          });

          filter.connect(out);
          out.connect(ctx.destination);
          (function loop () {
            if (end.isFulfilled()) return;
            requestAnimationFrame(loop);
            vizs.update();
          }());
          end.then(function () {
            out.disconnect(ctx.destination);
            sample.stop(ctx.currentTime);
            $(div).empty();
          }).done();
        });</script>

      <p style="font-size: 0.5em">
        <em>N.B. The Gain only works with lowshelf, highshelf and peaking.
          Also it is protected by a Compressor to not break your ears!</em>
      </p>

        </section>

        <section>
          <h2>FM + Filter Cutoff LFO</h2>

        <script type="text/javascript">hookRevealJS(function (div, end) {
          
          var out = ctx.createDynamicsCompressor();
          var filter = ctx.createBiquadFilter();

          var carrier = ctx.createOscillator(); carrier.start(0);
          var modulator = ctx.createOscillator(); modulator.start(0);
          var modGain = ctx.createGain(); modGain.gain.value = 440;
          modulator.connect(modGain);
          modGain.connect(carrier.frequency);
          carrier.connect(filter);

          var lfo = ctx.createOscillator(); lfo.start(0);
          var lfoGain = ctx.createGain();
          lfo.connect(lfoGain);
          lfoGain.connect(filter.frequency);

          var vizs = createVizs(ctx, div, out);

          var frequencyParam = new Parameter({
            curve: "quad",
            from: 0,
            to: 15000,
            title: "Filter Frequency 'center'"
          });
          var frequency = new ParameterSlider({
            model: frequencyParam
          });
          frequency.$el.appendTo(div);
          frequencyParam.on("change:value", function (m, value) {
            filter.frequency.value = value;
            syncLfoGain();
          });

          var qParam = new Parameter({
            from: 0,
            to: 50,
            title: "Filter Q"
          });
          var q = new ParameterSlider({
            model: qParam
          });
          q.$el.appendTo(div);
          qParam.on("change:value", function (m, value) {
            filter.Q.value = value;
          });

          var lfofreqParam = new Parameter({
            curve: "quad",
            from: 0,
            to: 20,
            title: "LFO Frequency"
          });
          var lfofreq = new ParameterSlider({
            model: lfofreqParam
          });
          lfofreq.$el.appendTo(div);
          lfofreqParam.on("change:value", function (m, value) {
            lfo.frequency.value = value;
          });

          var lfogainParam = new Parameter({
            from: 0,
            to: 1,
            title: "LFO Gain (%)"
          });
          var lfogainV = new ParameterSlider({
            model: lfogainParam
          });
          lfogainV.$el.appendTo(div);
          lfogainParam.on("change:value", function (m, value) {
            syncLfoGain();
          });

          function syncLfoGain () {
            lfoGain.gain.value = frequencyParam.get("value") * lfogainParam.get("value");
          }

          function noteOn (note) {
            var freq = NOTES[note];
            if (!freq) throw "no such freq";
            setFreq(freq);
          }

          function setFreq (freq) {
            modulator.frequency.value = 2*freq;
            carrier.frequency.value = 0.5*freq;
            modGain.gain.value = 2*freq;
          }

          setFreq(NOTES.C4);

          frequencyParam.set("value", 400);
          lfofreqParam.set("value", 2);
          lfogainParam.set("value", 1);

          keyboard.on("noteOn", noteOn);
          filter.connect(out);
          out.connect(ctx.destination);
          (function loop () {
            if (end.isFulfilled()) return;
            requestAnimationFrame(loop);
            vizs.update();
          }());
          end.then(function () {
            keyboard.off("noteOn", noteOn);
            out.disconnect(ctx.destination);
            $(div).empty();
          }).done();
        });</script>
        </section>
        </section>

        <section>
          <section data-markdown>
          ## DynamicsCompressorNode

          A **Compressor** dynamically normalizes the sound: 
          lowers the volume of the loudest parts. 
          raises the volume of the softest parts.
```
interface DynamicsCompressorNode : AudioNode {
    readonly attribute AudioParam threshold; // in Decibels
    readonly attribute AudioParam knee; // in Decibels
    readonly attribute AudioParam ratio; // unit-less
    readonly attribute AudioParam reduction; // in Decibels
    readonly attribute AudioParam attack; // in Seconds
    readonly attribute AudioParam release; // in Seconds
};          
```
          </section>
        <section>
          <h2>Compressor</h2>
        <script type="text/javascript">hookRevealJS(function (div, end) {
          var sample = ctx.createBufferSource();
          sample.loop = true;
          var out = ctx.createDynamicsCompressor();
          var gain = ctx.createGain();
          gain.connect(out);

          var sine = ctx.createOscillator(); sine.start(0);
          var sineGain = ctx.createGain();
          sineGain.connect(out);
          sine.type = "sine";
          sine.frequency.value = 300;
          sine.connect(sineGain);
          var kickVolume;
          var kickFilter = ctx.createBiquadFilter();
          kickFilter.frequency.value = 600;
          kickFilter.Q.value = 6;
          kickFilter.connect(out);

          var vizs = createVizs(ctx, div, out);

          var sinegainParam = new Parameter({
            from: 0,
            to: 10,
            value: 1,
            title: "Sine Gain"
          });
          var sinegainSlider = new ParameterSlider({
            model: sinegainParam
          });
          sinegainSlider.$el.appendTo(div);
          sinegainParam.on("change:value", function (m, value) {
            sineGain.gain.value = value;
          });

          var gainParam = new Parameter({
            from: 0,
            to: 10,
            value: 1,
            title: "Song Gain"
          });
          var gainSlider = new ParameterSlider({
            model: gainParam
          });
          gainSlider.$el.appendTo(div);
          gainParam.on("change:value", function (m, value) {
            gain.gain.value = value;
          });

          var kickGainParam = new Parameter({
            from: 0,
            to: 10,
            value: 1,
            title: "Kick Gain"
          });
          var kickGainSlider = new ParameterSlider({
            model: kickGainParam
          });
          kickGainSlider.$el.appendTo(div);
          kickGainParam.on("change:value", function (m, value) {
            kickVolume = value;
          });


          sinegainParam.set("value", 0);
          gainParam.set("value", 0);
          kickGainParam.set("value", 0);

          function kick (note) {
            var freq = NOTES[note];
            if (!freq) throw "no such freq for note="+note;
            var osc = ctx.createOscillator();
            osc.type = "square";
            osc.start(0);
            var gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(kickFilter);
            var t = ctx.currentTime;
            osc.frequency.setValueAtTime(freq, t);
            osc.frequency.linearRampToValueAtTime(0, t+0.2);
            var envelopeOff = noteEnvelope(gain, t, kickVolume, 0.01, 0.1, 0.5, 0.2);
            setTimeout(function(){ 
              envelopeOff(t+0.2).then(function () {
                osc.stop(0);
                gain.disconnect(kickFilter);
              });
            }, 150);
          }

          keyboard.on("noteOn", kick);

          music2.then(function (buffer) {
            sample.buffer = buffer;
            sample.start(ctx.currentTime);
            sample.connect(gain);
          });

          var $reductionDiv = $('<div style="">Reduction: <strong style="color: #fff" class="reduction">0</strong> dB</div>').appendTo(div);
          var $reduction = $reductionDiv.find(".reduction");

          out.connect(ctx.destination);
          (function loop () {
            if (end.isFulfilled()) return;
            $reduction.text(out.reduction.value.toFixed(2));
            requestAnimationFrame(loop);
            vizs.update();
          }());
          end.then(function () {
            keyboard.off("noteOn", kick);
            out.disconnect(ctx.destination);
            sample.stop(ctx.currentTime);
            $(div).empty();
          }).done();
          });</script>
        </section>

        </section>

        <section>
          <section data-markdown>
            ## Making Noise

```
  function Noise (ctx) {
    var bufferSize = 2 * ctx.sampleRate,
    noiseBuffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate),
    output = noiseBuffer.getChannelData(0);
    for (var i = 0; i < bufferSize; i++) {
      output[i] = Math.random() * 2 - 1;
    }
    var whiteNoise = ctx.createBufferSource();
    whiteNoise.buffer = noiseBuffer;
    whiteNoise.loop = true;

    this.out = whiteNoise;
  }
```

![](./images/noise.png)
          </section>

          <section data-markdown>
          ## Protecting with Filter
```
{
    // ...
    var gain = ctx.createGain();
    whiteNoise.connect(gain);

    var filter = ctx.createBiquadFilter();
    gain.connect(filter);
    filter.type = "lowpass";

    this.white = whiteNoise;
    this.gain = gain;
    this.out = this.filter = filter;
}
```

![](./images/noise_filtered.png)
          </section>

          <section>
          <h2>Noise + Filter</h2>

        <script type="text/javascript">hookRevealJS(function (div, end) {
          var sample = ctx.createBufferSource();
          sample.loop = true;
          var out = ctx.createDynamicsCompressor();

          var noise = new Noise(ctx);
          noise.out.connect(out);

          var vizs = createVizs(ctx, div, out);

          var gainParam = new Parameter({
            from: 0,
            to: 1,
            title: "Gain"
          });
          gainParam.on("change:value", function (m, value) {
            noise.gain.gain.value = value;
          });
          var gainView = new ParameterSlider({
            model: gainParam
          });
          gainView.$el.appendTo(div);

          var filterParam = new Parameter({
            curve: "quad",
            from: 0,
            to: ctx.sampleRate,
            title: "Filter"
          });
          filterParam.on("change:value", function (m, value) {
            noise.filter.frequency.value = value;
          });
          var filterView = new ParameterSlider({
            model: filterParam
          });
          filterView.$el.appendTo(div);

          var qParam = new Parameter({
            from: 0,
            to: 100,
            title: "Q"
          });
          qParam.on("change:value", function (m, value) {
            noise.filter.Q.value = value;
          });
          var qView = new ParameterSlider({
            model: qParam
          });
          qView.$el.appendTo(div);
          
          var types = [
          "lowpass",
          "highpass",
          "bandpass",
          "notch"
          ];
          var typeParam = new Parameter({
            values: types,
            title: "Type"
          });
          var typeV = new ParameterSlider({
            model: typeParam
          });
          typeV.$el.appendTo(div);
          typeParam.on("change:value", function (m, value) {
            noise.filter.type = types[value];
          });

          gainParam.set("value", 0.5);
          filterParam.set("value", 800);

          noise.white.start(ctx.currentTime);
          out.connect(ctx.destination);
          (function loop () {
            if (end.isFulfilled()) return;
            requestAnimationFrame(loop);
            vizs.update();
          }());
          end.then(function () {
            out.disconnect(ctx.destination);
            noise.white.stop(ctx.currentTime);
            $(div).empty();
          }).done();
        });</script>
          </section>
        </section>

        <section>
          <section data-markdown>
          ## DelayNode

          A DelayNode delays input to a given time.
```
interface DelayNode : AudioNode {
    readonly attribute AudioParam delayTime;
};
```
          </section>
          <section>
          <h2>Delay effect example</h2>
          <img src="./images/repeater.png" style="padding: 10px; background: #fff" />
          </section>
          <section>
          <h2>"Repeater"</h2>

        <script type="text/javascript">hookRevealJS(function (div, end) {
          var sample = ctx.createBufferSource();
          sample.loop = true;
          var out = ctx.createDynamicsCompressor();

          var vizs = createVizs(ctx, div, out);

          var gain = ctx.createGain();
          var delay = ctx.createDelay();
          var repeatGain = ctx.createGain();
          gain.connect(delay);
          delay.connect(repeatGain);
          repeatGain.connect(gain);
          gain.connect(out);

          var gainParam = new Parameter({
            from: 0,
            to: 1,
            title: "Gain"
          });
          gainParam.on("change:value", function (m, value) {
            gain.gain.value = value;
          });
          var gainView = new ParameterSlider({
            model: gainParam
          });
          gainView.$el.appendTo(div);

          var repeatGainParam = new Parameter({
            from: 0,
            to: 1,
            title: "Delay Gain"
          });
          repeatGainParam.on("change:value", function (m, value) {
            repeatGain.gain.value = value;
          });
          var repeatGainView = new ParameterSlider({
            model: repeatGainParam
          });
          repeatGainView.$el.appendTo(div);
          
          var delayParam = new Parameter({
            curve: "quad",
            from: 0,
            to: 2,
            title: "Delay Time"
          });
          delayParam.on("change:value", function (m, value) {
            delay.delayTime.value = value;
          });
          var delayView = new ParameterSlider({
            model: delayParam
          });
          delayView.$el.appendTo(div);
          
          music2.then(function (buffer) {
            sample.buffer = buffer;
            sample.start(ctx.currentTime);
            sample.connect(gain);
          });

          gainParam.set("value", 0.5);
          delayParam.set("value", 0.2);
          repeatGainParam.set("value", 0.3);

          out.connect(ctx.destination);
          (function loop () {
            if (end.isFulfilled()) return;
            requestAnimationFrame(loop);
            vizs.update();
          }());
          end.then(function () {
            out.disconnect(ctx.destination);
            $(div).empty();
          }).done();
        });</script>
          </section>
        </section>
        
        <section>
          <section data-markdown>
          ## ConvolverNode
          
          > ConvolverNode applies a linear convolution effect given an impulse response.

          ![](./images/convolution.gif)
          </section>
          <section data-markdown>
          ![](./images/music.png)

          ![](./images/impulse.png)

          ![](./images/music_reverbed.png)
          </section>
          <section>
            <h2>Convolution</h2>
        <script type="text/javascript">hookRevealJS(function (div, end) {
          // Modules
          var out = ctx.createDynamicsCompressor();
          var sample = ctx.createBufferSource(); sample.loop = true;
          var convolver = ctx.createConvolver();
          var dry = ctx.createGain();
          var wet = ctx.createGain();

          // Schema
          sample.connect(dry);
          sample.connect(wet);
          dry.connect(out);
          wet.connect(convolver);
          convolver.connect(out);

          var mix = new Parameter({
            from: 0,
            to: 1,
            title: "Mix (Dry -> Wet)"
          });
          mix.on("change:value", function (m, value) {
            dry.gain.value = 1-value;
            wet.gain.value = value;
          });
          mix.set("value", 0.5);
          var mixView = new ParameterSlider({
            model: mix
          });

          var musics = [
            music1,
            music2
          ];
          var musicParam = new Parameter({
            values: ["piano", "rock"],
            title: "Music"
          });
          musicParam.on("change:value", function (m, value) {
            musics[value].then(function (buffer) {
              sample.buffer = buffer;
              sample.start(ctx.currentTime);
            });
          });
          musicParam.trigger("change:value", musicParam, musicParam.get("value"));
          var musicView = new ParameterSlider({
            model: musicParam
          });

          var vizs = createVizs(ctx, div, out);
          musicView.$el.appendTo(div);
          mixView.$el.appendTo(div);

          function replaceBuffer (c) {
            convolver.buffer = c;
          }

          var churchConv = loadSound(ctx, "./audio/convolutions/Church-Schellingwoude.mp3");

          var p = $('<p></p>').appendTo(div);
          var h3 = $('<label for="impulsefile">Select an Impulse Response Audio File: </label>').appendTo(p);
          var fileInput = $('<input id="impulsefile" type="file" style="font-size: 0.8em; padding: 0.6em 0em; color: #000" />').appendTo(p);

          churchConv.then(replaceBuffer);
          fileInput.on("change", function () {
            loadFileAudio(ctx, fileInput[0]).then(replaceBuffer).done();
          });

          out.connect(ctx.destination);
          (function loop () {
            if (end.isFulfilled()) return;
            requestAnimationFrame(loop);
            vizs.update();
          }());
          end.then(function () {
            out.disconnect(ctx.destination);
            $(div).empty();
          }).done();
        });</script>

      <p style="font-size: 0.5em; font-style: italic">
        You can find some Impulse Response on the internet (e.g. <a href="http://www.cksde.com/p_6_250.htm">here</a>),
        or you can record it yourself!
      </p>

          </section>
        </section>
        
        <section>
          <section data-markdown>
          ## ChannelSplitterNode

          ![](./images/channel-splitter.png)
          </section>
        </section>
        
        <section>
          <section data-markdown>
          ## ChannelMergerNode

          ![](./images/channel-merger.png)
          </section>
          <section data-markdown>
          ## Making Stereo Echo Effects

```
// Schema:
var input = ctx.createGain();
var left = ctx.createGain();
var right = ctx.createGain();
var delayL = ctx.createDelay();
var delayR = ctx.createDelay();
var delayGainL = ctx.createGain();
var delayGainR = ctx.createGain();
input.connect(left);
input.connect(right);
left.connect(delayL);
left.connect(delayR);
delayL.connect(delayGainL);
delayR.connect(delayGainR);
delayGainL.connect(left);
delayGainR.connect(right);
var merger = ctx.createChannelMerger();
left.connect(merger, 0, 0);
right.connect(merger, 0, 1);

// Basic Usage:
delayL.delayTime.value = 0.2; // second
delayL.delayTime.value = 0.3; // second
delayGainL.gain.value = 0.3;
delayGainR.gain.value = 0.4;

anything.connect(input);
merger.connect(ctx.destination);

```
          </section>
          <section>
          <h2>Stereo echo</h2>

        <script type="text/javascript">hookRevealJS(function (div, end) {
          var sample = ctx.createBufferSource();
          sample.loop = true;
          var out = ctx.createDynamicsCompressor();

          var vizs = createVizs(ctx, div, out);

          var input = ctx.createGain();
          var left = ctx.createGain();
          var right = ctx.createGain();
          var delayL = ctx.createDelay();
          var delayR = ctx.createDelay();
          var delayGainL = ctx.createGain();
          var delayGainR = ctx.createGain();
          input.connect(left);
          input.connect(right);
          left.connect(delayL);
          left.connect(delayR);
          delayL.connect(delayGainL);
          delayR.connect(delayGainR);
          delayGainL.connect(left);
          delayGainR.connect(right);
          var merger = ctx.createChannelMerger();
          left.connect(merger, 0, 0);
          right.connect(merger, 0, 1);

          merger.connect(out);

          $('<h4>Left</h4>').appendTo(div);

          var leftParam = new Parameter({
            from: 0,
            to: 1,
            title: "Gain"
          });
          leftParam.on("change:value", function (m, value) {
            left.gain.value = value;
          });
          var leftView = new ParameterSlider({
            model: leftParam,
            width: '30%'
          });
          leftView.$el.appendTo(div);

          var delayGainLParam = new Parameter({
            from: 0,
            to: 1,
            title: "Delay Gain"
          });
          delayGainLParam.on("change:value", function (m, value) {
            delayGainL.gain.value = value;
          });
          var delayGainLView = new ParameterSlider({
            model: delayGainLParam,
            width: '30%'
          });
          delayGainLView.$el.appendTo(div);
          delayGainLView.$el.css("margin-left", "5%");
          
          var delayLParam = new Parameter({
            curve: "quad",
            from: 0,
            to: 2,
            title: "Delay Time"
          });
          delayLParam.on("change:value", function (m, value) {
            delayL.delayTime.value = value;
          });
          var delayLView = new ParameterSlider({
            model: delayLParam,
            width: '30%'
          });
          delayLView.$el.appendTo(div);
          delayLView.$el.css("margin-left", "5%");

          $('<h4>Right</h4>').appendTo(div);

          var rightParam = new Parameter({
            from: 0,
            to: 1,
            title: "Gain"
          });
          rightParam.on("change:value", function (m, value) {
            right.gain.value = value;
          });
          var rightView = new ParameterSlider({
            model: rightParam,
            width: '30%'
          });
          rightView.$el.appendTo(div);

          var delayGainRParam = new Parameter({
            from: 0,
            to: 1,
            title: "Delay Gain"
          });
          delayGainRParam.on("change:value", function (m, value) {
            delayGainR.gain.value = value;
          });
          var delayGainRView = new ParameterSlider({
            model: delayGainRParam,
            width: '30%'
          });
          delayGainRView.$el.appendTo(div);
          delayGainRView.$el.css("margin-left", "5%");
          
          var delayRParam = new Parameter({
            curve: "quad",
            from: 0,
            to: 2,
            title: "Delay Time"
          });
          delayRParam.on("change:value", function (m, value) {
            delayR.delayTime.value = value;
          });
          var delayRView = new ParameterSlider({
            model: delayRParam,
            width: '30%'
          });
          delayRView.$el.appendTo(div);
          delayRView.$el.css("margin-left", "5%");
          
          music2.then(function (buffer) {
            sample.buffer = buffer;
            sample.start(ctx.currentTime);
            sample.connect(input);
          });

          leftParam.set("value", 0.8);
          delayLParam.set("value", 0.2);
          delayGainLParam.set("value", 0.3);

          rightParam.set("value", 0.8);
          delayRParam.set("value", 0.3);
          delayGainRParam.set("value", 0.4);

          out.connect(ctx.destination);
          (function loop () {
            if (end.isFulfilled()) return;
            requestAnimationFrame(loop);
            vizs.update();
          }());
          end.then(function () {
            out.disconnect(ctx.destination);
            $(div).empty();
          }).done();
        });</script>
          </section>
        </section>

        <section>
          <section data-markdown>
          ## WaveShaperNode

          > WaveShaperNode is an AudioNode processor implementing non-linear distortion effects.
          
          > Non-linear waveshaping distortion is commonly used for both subtle non-linear warming, or more obvious distortion effects. Arbitrary non-linear shaping curves may be specified.


          *(no example yet)*
          </section>
        </section>
        
        <section>
          <section data-markdown>
          ## ScriptProcessorNode

          > This interface is an AudioNode which can generate, process, or analyse audio directly using JavaScript.
          </section>
          <section data-markdown>
            ## ScriptProcessorNode Noise Implementation

```
var node = ctx.createScriptProcessor(1024, 1, 1);
node.onaudioprocess = function (e) {
  var output = e.outputBuffer.getChannelData(0);
  for (var i = 0; i < output.length; i++) {
    output[i] = Math.random();
  }
};
node.connect(ctx.destination);
```

> N.B. It is recommended to use a buffer noise loop approach for better performances.

**Indeed, ScriptProcessorNode can be CPU consuming.**
          </section>
        </section>

        <section>

          <section data-markdown>
          # Final words
          </section>

          <section data-markdown>
            ## Web Audio API is Awesome!

            * Audio Nodes are simple but useful
            * **Audio Modular** is very powerful
            * Very efficient
          </section>

          <section data-markdown>
            ## Cons

            * **Implementing by Hand is quite heavy**
              * A lot of LoC for doing your stuff
              * counter-productive for testing / adjusting
              * solution: making a node editor (Zound goal)
            * **Today's support**
              * Chrome Desktop: ok, still missing the `PeriodicWave`.
              * Chrome Mobile: it works, but not so efficient.
              * Firefox: only in Aurora, still in WIP
          </section>

          <section>
            <h2>I made a game!</h2>

            <a href="http://greweb.me/2013/09/timelapse/">
              http://greweb.me/2013/09/timelapse/
              <img src="./images/timelapse_game.png" width=500 alt="" />
            </a>
          </section>

          <section data-markdown>
            ## Questions?

            [@greweb](http://twitter.com/greweb)
          </section>
        </section>
        
      </div>

    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.min.js"></script>

    <script>

      $(document).on("keydown", function (e) {
        switch (e.keyCode) {
          case 37: Reveal.navigateLeft(); break;
          case 39: Reveal.navigateRight(); break;
          case 38: Reveal.navigateUp(); break;
          case 40: Reveal.navigateDown(); break;
          case 32: Reveal.navigateNext(); break;
        }
      });

      // Full list of configuration options available here:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        keyboard: false,
        controls: true,
        progress: true,
        history: true,
        center: true,

        theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
        transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

        // Optional libraries used to extend on reveal.js
        dependencies: [
          { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
        ]
      });

    </script>

  </body>
</html>
